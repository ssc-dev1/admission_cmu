<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="odoocms_receipt_tree" model="ir.ui.view">
            <field name="name">account.move.tree</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <tree string="Fee Receipts" create="false" delete="false"
                      decoration-primary="payment_state == 'not_paid'"
                      decoration-success="payment_state in ('in_payment','paid')">

                    <field name="student_id"/>
                    <field name="term_id"/>
                    <field name="semester_id" optional="hide"/>
                    <field name="invoice_date" string="Invoice Date" optional="show"/>
                    <field name="invoice_date_due" optional="show"/>
                    <field name="payment_date" optional="show"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="receipt_type_ids" widget="many2many_tags" optional="hide"/>

                    <field name="amount_total_signed" string="Total" sum="Total"/>
                    <field name="amount_residual" optional="1" string="Amount Due" sum="Amount Due"/>

                    <field name="waiver_ids" widget="many2many_tags" optional="hide"/>
                    <field name="waiver_percentage" optional="hide"/>
                    <field name="waiver_amount" optional="1" string="Waiver Amount" sum="Waiver Amount"/>

                    <field name="payment_state" string="Payment Status"/>
                    <field name="state" optional="hide"/>

                    <field name="is_fee" invisible="1"/>
                    <field name="commercial_partner_id" invisible="1"/>
                    <field name="reference" invisible="1"/>
                    <field name="name" invisible="1"/>
                    <field name="company_id" invisible="1"/>
                    <field name="user_id" string="Responsible" invisible="1"/>
                    <field name="invoice_origin" invisible="1"/>
                    <field name="currency_id" optional="hide"/>
                    <field name="company_currency_id" invisible="1"/>

                    <field name="cancel_due_to_arrears" invisible="1"/>
                    <field name="institute_id" optional="1"/>
                    <field name="session_id" optional="1"/>

                </tree>
            </field>
        </record>

        <record id="odoocms_receipt_form" model="ir.ui.view">
            <field name="name">account.move.form.fee</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <form string="Student Invoice" class="o_invoice_form" delete="false" create="false">
                    <header>
                        <button name="action_post" string="Confirm" class="oe_highlight"
                                type="object" groups="account.group_account_invoice" data-hotkey="v"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"/>

                        <button name="button_cancel" string="Cancel Receipt" type="object"
                                groups="account.group_account_invoice"
                                attrs="{'invisible' : ['|', '|',('id', '=', False), ('payment_state', '!=', 'not_paid'),('state','=','cancel')]}"
                                class="oe_highlight o_invoice_validate"/>

                        <button name="button_set_draft" string="Reset to Draft" type="object" groups="account.group_account_invoice"
                                attrs="{'invisible' : ['|',('show_reset_to_draft_button', '=', False),('state','=','cancel')]}" data-hotkey="q" />
                        <!-- Set as Checked -->
                        <button name="button_set_checked" string="Set as Checked" type="object" groups="account.group_account_invoice"
                                attrs="{'invisible' : [('to_check', '=', False)]}" data-hotkey="k" />
                        <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                    </header>

                    <div groups="account.group_account_invoice" class="alert alert-info mb-0" role="alert"
                        attrs="{'invisible': ['|', ('invoice_has_outstanding', '=', False), ('payment_state', 'not in', ('not_paid', 'partial'))]}">
                        You have <bold> <a class="alert-link" href="#outstanding" role="button">outstanding payments</a></bold>
                        for this Student. You can allocate them to mark this invoice as paid.
                    </div>

                    <sheet>
                        <div name="button_box" class="oe_button_box">
                            <button name="open_payment_view"
                                    class="oe_stat_button"
                                    icon="fa-bars"
                                    type="object"
                                    attrs="{'invisible': ['|', '|', ('move_type', '!=', 'entry'), ('id', '=', False), ('payment_id', '=', False)]}"
                                    string="1 Payment">
                            </button>
                            <button name="open_reconcile_view"
                                    class="oe_stat_button"
                                    icon="fa-bars"
                                    type="object"
                                    attrs="{'invisible': ['|', '|', ('move_type', '!=', 'entry'), ('id', '=', False), ('has_reconciled_entries', '=', False)]}"
                                    string="Reconciled Entries">
                            </button>
                        </div>

                        <!-- Payment status for invoices / receipts -->
                        <widget name="web_ribbon" title="Paid"
                                attrs="{'invisible': ['|', ('payment_state', '!=', 'paid'), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                        <widget name="web_ribbon" title="In Payment"
                                attrs="{'invisible': ['|', ('payment_state', '!=', 'in_payment'), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                        <widget name="web_ribbon" title="Partial"
                                attrs="{'invisible': ['|', ('payment_state', '!=', 'partial'), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                        <widget name="web_ribbon" title="Reversed"
                                bg_color="bg-danger"
                                attrs="{'invisible': [('payment_state', '!=', 'reversed')]}"/>
                        <widget name="web_ribbon" text="Invoicing App Legacy"
                                bg_color="bg-info"
                                attrs="{'invisible': [('payment_state', '!=', 'invoicing_legacy')]}"
                                tooltip="This entry has been generated through the Invoicing app, before installing Accounting. It has been disabled by the 'Invoicing Switch Threshold Date' setting so that it does not impact your accounting."/>

                        <!-- Invisible fields -->
                        <field name="id" invisible="1"/>
                        <field name="show_name_warning" invisible="1"/>
                        <field name="posted_before" invisible="1"/>
                        <field name="move_type" invisible="1"/>
                        <field name="payment_state" invisible="1" force_save="1"/>
                        <field name="invoice_filter_type_domain" invisible="1"/>
                        <field name="suitable_journal_ids" invisible="1"/>
                        <field name="company_currency_id" invisible="1"/>
                        <field name="commercial_partner_id" invisible="1"/>
                        <field name="bank_partner_id" invisible="1"/>
                        <field name="display_qr_code" invisible="1"/>
                        <field name="show_reset_to_draft_button" invisible="1"/>

                        <field name="invoice_has_outstanding" invisible="1"/>
                        <field name="is_move_sent" invisible="1"/>
                        <field name="invoice_has_matching_suspense_amount" invisible="1"/>
                        <field name="has_reconciled_entries" invisible="1"/>
                        <field name="restrict_mode_hash_table" invisible="1"/>
                        <field name="country_code" invisible="1"/>
                        <field name="display_inactive_currency_warning" invisible="1"/>
                        <field name="statement_id" invisible="1"/>
                        <field name="payment_id" invisible="1"/>
                        <field name="tax_country_id" invisible="1"/>
                        <field name="tax_cash_basis_created_move_ids" invisible="1"/>
                        <field name="challan_type" invisible="1"/>

                        <div class="oe_title">
                            <!-- Invoice draft header -->
                            <span class="o_form_label"><field name="move_type" attrs="{'invisible': [('move_type', '=', 'entry')]}" readonly="1" nolabel="1"/></span>
                            <h1 attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('name', '!=', '/')]}">
                                <span>Draft</span>
                            </h1>

                            <!-- Number -->
                            <span class="text-warning" attrs="{'invisible': [('show_name_warning', '=', False)]}">The current highest number is <field name="highest_name"/>. You might want to put a higher number here.</span>
                            <h1 class="mt0" attrs="{'invisible':[('name', '=', '/'), ('posted_before', '=', False)]}">
                                <field name="name" attrs="{'readonly': [('state', '!=', 'draft')]}" placeholder="JRNL/2016/00001"/>
                            </h1>
                        </div>

                        <group>
                            <group id="header_left_group">
                                <field name="student_id" options="{'no_create_edit': True, 'no_create': True}"
                                       attrs="{'readonly': [('move_type','!=','out_refund')]}"/>

                                <div class="o_td_label">
                                    <label for="partner_id" string="Partner" style="font-weight:bold;"
                                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt'))]}"/>
                                </div>

                                <field name="partner_id" widget="res_partner_many2one" nolabel="1"
                                       context="{
                                            'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer')
                                                or (context.get('default_move_type', 'entry') in ('in_invoice', 'in_refund', 'in_receipt') and 'supplier') or False,
                                            'show_address': 0, 'default_is_company': False, 'show_vat': False}"
                                       domain="[('type', '!=', 'private'), ('company_id', 'in', (False, company_id))]"
                                       options='{"always_reload": True, "no_quick_create": True}'
                                       attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>

                                <field name="program_id" options="{'no_create_edit': True, 'no_create': True}" readonly="1"/>
                                <field name="fee_structure_id" readonly="1"
                                    attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}"/>
                                <field name="term_id"/>
                                <field name="receipt_type_ids" widget="many2many_tags" readonly="1"
                                    attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}"/>
                            </group>
                            <group id="header_right_group">
                                <!-- Invoice date (only invoices / receipts) -->
                                <div class="o_td_label">
                                    <label for="invoice_date" string="Invoice Date" style="font-weight:bold;"
                                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt'))]}"/>
                                    <label for="invoice_date" string="Bill Date" style="font-weight:bold;"
                                           attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}"/>
                                </div>
                                <field name="invoice_date" nolabel="1" options="{'datepicker': {'warn_future': true}}"
                                       attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>

                                <field name="payment_date" readonly="1"/>

                                <!-- Invoice payment terms (only invoices) + due date (only invoices / receipts) -->
                                <label for="invoice_payment_term_id" string="Due Date"
                                       attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                                <div class="d-flex" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}">
                                    <field name="invoice_date_due" force_save="1"
                                           placeholder="Date"
                                           attrs="{'invisible': [('invoice_payment_term_id', '!=', False)]}"/>
                                    <span class="o_form_label mx-3 oe_edit_only"
                                          attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_payment_term_id', '!=', False)]}"> or </span>
                                    <field name="invoice_payment_term_id"
                                           placeholder="Terms"/>
                                </div>

                                <field name="currency_id"
                                       attrs="{'readonly': [('state', '!=', 'draft')]}"
                                       groups="account.group_account_readonly,base.group_multi_currency"/>

                            </group>
                        </group>

                        <notebook>
                            <page id="invoice_tab" string="Invoice Lines" attrs="{'invisible': [('move_type', '=', 'entry')]}">
                                <field name="invoice_line_ids" widget="section_and_note_one2many" mode="tree,kanban"
                                       context="{'default_move_type': context.get('default_move_type'), 'journal_id': journal_id, 'default_partner_id': commercial_partner_id, 'default_currency_id': currency_id or company_currency_id}">
                                    <tree delete="false" editable="bottom" string="Journal Items"
                                            default_order="sequence, date desc, move_name desc, id"
                                            decoration-success="registration_type =='add'" decoration-danger="registration_type =='drop'">
                                        <control>
                                            <create name="add_line_control" string="Add a line"/>
                                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <!-- Displayed fields -->
                                        <field name="sequence" widget="handle"/>
                                        <field name="move_name" invisible="1"/>
                                        <field name="product_id" optional="show"
                                               domain="
                                                    context.get('default_move_type') in ('out_invoice', 'out_refund', 'out_receipt')
                                                    and [('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]
                                                    or [('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]
                                               "/>
                                        <field name="name" widget="section_and_note_text" attrs="{'required': [('parent.move_type', 'not in', ('in_invoice', 'in_refund','in_receipt'))]}"/>
                                        <field name="account_id"
                                               groups="account.group_account_readonly"
                                               options="{'no_create': True}"
                                               domain="[('deprecated', '=', False), ('user_type_id.type', 'not in', ('receivable', 'payable')), ('company_id', '=', parent.company_id), ('is_off_balance', '=', False)]"
                                               attrs="{'required': [('display_type', '=', False)]}"/>
                                        <field name="analytic_account_id"
                                               domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                               groups="analytic.group_analytic_accounting"
                                               optional="show"/>
                                        <field name="analytic_tag_ids"
                                               domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                               groups="analytic.group_analytic_tags"
                                               optional="show"
                                               widget="many2many_tags"/>
                                        <field name="fee_head_id" optional="hide"/>
                                        <field name="fee_category_id" optional="hide"/>
                                        <field name="quantity"/>
                                        <field name="product_uom_category_id" invisible="1"/>
                                        <field name="product_uom_id" string="UoM" groups="uom.group_uom" optional="show"/>
                                        <field name="price_unit" string="Price"/>

                                        <field name="course_credit_hours" string="Credit Hours"
                                            attrs="{'column_invisible':[('parent.move_type', '!=', 'out_invoice')]}"/>
                                        <field name="course_gross_fee" string="Gross Fee"
                                            attrs="{'column_invisible':[('parent.move_type', '!=', 'out_invoice')]}"/>
                                        <field name="registration_type" optional="hide"/>
                                        <field name="section_name" optional="hide"/>
                                        <field name="add_drop_no" string="Add Drop No" optional="show"
                                            attrs="{'column_invisible':[('parent.challan_type', '!=', 'add_drop')]}"/>
                                        <field name="add_drop_paid_amount" optional="hide"
                                            attrs="{'column_invisible':[('parent.challan_type', '!=', 'add_drop')]}"/>

                                        <field name="discount" string="Disc.%" optional="hide"/>
                                        <field name="tax_ids" widget="many2many_tags"
                                               domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain), ('company_id', '=', parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                               context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain}"
                                               options="{'no_create': True}"
                                               optional="show"/>
                                        <field name="price_subtotal"
                                               string="Subtotal"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total"
                                               string="Total"
                                               groups="account.group_show_line_subtotals_tax_included"/>

                                        <!-- Others fields -->
                                        <field name="registration_type" invisible="1"/>
                                        <field name="partner_id" invisible="1"/>
                                        <field name="amount_currency" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="debit" invisible="1"/>
                                        <field name="credit" invisible="1"/>
                                        <field name="date" invisible="1"/>
                                        <field name="date_maturity" invisible="1"/>

                                        <field name="group_tax_id" invisible="1"/>
                                        <field name="tax_line_id" invisible="1"/>
                                        <field name="tax_repartition_line_id" invisible="1"/>
                                        <field name="tax_tag_ids" invisible="1"/>
                                        <field name="tax_base_amount" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="recompute_tax_line" invisible="1" force_save="1"/>
                                        <field name="display_type" force_save="1" invisible="1"/>
                                        <field name="is_rounding_line" invisible="1"/>
                                        <field name="exclude_from_invoice_tab" invisible="1"/>
                                        <field name="account_internal_type" invisible="1"/>
                                        <field name="account_internal_group" invisible="1"/>
                                    </tree>
                                    <kanban class="o_kanban_mobile">
                                        <!-- Displayed fields -->
                                        <field name="name"/>
                                        <field name="product_id"/>
                                        <field name="price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        <field name="quantity"/>
                                        <field name="product_uom_category_id" invisible="1"/>
                                        <field name="product_uom_id" groups="uom.group_uom"/>
                                        <field name="price_unit"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div t-attf-class="oe_kanban_card oe_kanban_global_click pl-0 pr-0 {{ record.display_type.raw_value ? 'o_is_' + record.display_type.raw_value : '' }}">
                                                    <t t-if="!record.display_type.raw_value">
                                                        <div class="row no-gutters">
                                                            <div class="col-2 pr-3">
                                                                <img t-att-src="kanban_image('product.product', 'image_128', record.product_id.raw_value)" t-att-title="record.product_id.value" t-att-alt="record.product_id.value" style="max-width: 100%;"/>
                                                            </div>
                                                            <div class="col-10">
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <strong t-esc="record.product_id.value"/>
                                                                    </div>
                                                                    <div class="col-auto">
                                                                        <strong class="float-right text-right">
                                                                            <t t-esc="record.price_subtotal.value" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                                            <t t-esc="record.price_total.value" groups="account.group_show_line_subtotals_tax_included"/>
                                                                        </strong>
                                                                    </div>
                                                                </div>
                                                                <div class="text-muted">
                                                                    Quantity:
                                                                    <t t-esc="record.quantity.value"/>
                                                                    <t t-esc="record.product_uom_id.value"/>
                                                                </div>
                                                                <div class="text-muted">
                                                                    Unit Price:
                                                                    <t t-esc="record.price_unit.value"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-if="record.display_type.raw_value === 'line_section' || record.display_type.raw_value === 'line_note'">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <t t-esc="record.name.value"/>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>
                                        </templates>

                                        <!-- Others fields -->
                                        <field name="partner_id" invisible="1"/>
                                        <field name="amount_currency" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="debit" invisible="1"/>
                                        <field name="credit" invisible="1"/>
                                        <field name="date" invisible="1"/>
                                        <field name="date_maturity" invisible="1"/>

                                        <field name="group_tax_id" invisible="1"/>
                                        <field name="tax_line_id" invisible="1"/>
                                        <field name="tax_repartition_line_id" invisible="1"/>
                                        <field name="tax_tag_ids" invisible="1"/>
                                        <field name="tax_base_amount" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="recompute_tax_line" invisible="1" force_save="1"/>
                                        <field name="display_type" force_save="1" invisible="1"/>
                                        <field name="is_rounding_line" invisible="1"/>
                                        <field name="exclude_from_invoice_tab" invisible="1"/>
                                        <field name="account_internal_type" invisible="1"/>
                                        <field name="account_internal_group" invisible="1"/>
                                    </kanban>

                                    <!-- Form view to cover mobile use -->
                                    <form>
                                        <sheet>
                                            <field name="product_uom_category_id" invisible="1"/>
                                            <field name="display_type" invisible="1"/>
                                            <field name="parent_state" invisible="1"/>
                                            <group>
                                                <field name="partner_id" invisible="1"/>
                                                <field name="company_id" invisible="1"/>
                                                <field name="debit" invisible="1"/>
                                                <field name="credit" invisible="1"/>
                                                <field name="product_id" widget="many2one_barcode"/>
                                                <field name="quantity"/>
                                                <field name="product_uom_id" groups="uom.group_uom"/>
                                                <field name="price_unit"/>
                                                <field name="discount" string="Disc.%"/>
                                                <field name="currency_id" invisible="1"/>
                                                <field name="amount_currency" invisible="1"/>
                                                <field name="recompute_tax_line" invisible="1" force_save="1"/>
                                            </group>
                                            <group>
                                                <field name="analytic_tag_ids" groups="analytic.group_analytic_tags" widget="many2many_tags"/>
                                                <field name="account_id" options="{'no_create': True}" domain="[('company_id', '=', company_id)]" />
                                                <field name="tax_ids" widget="many2many_tags"/>
                                                <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>
                                            </group>
                                            <label for="name" string="Description" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                                            <label for="name" string="Section" attrs="{'invisible': [('display_type', '!=', 'line_section')]}"/>
                                            <label for="name" string="Note" attrs="{'invisible': [('display_type', '!=', 'line_note')]}"/>
                                            <field name="name" widget="text"/>
                                            <group>
                                                <field name="price_subtotal" string="Subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                                <field name="price_total" string="Total" groups="account.group_show_line_subtotals_tax_included"/>
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                                <group col="12" class="oe_invoice_lines_tab">
                                    <group colspan="8">
                                        <field name="narration" placeholder="Terms and Conditions" class="oe_inline text-break" nolabel="1"/>
                                    </group>
                                    <!-- Totals (only invoices / receipts) -->
                                    <group colspan="4">
                                        <group class="oe_subtotal_footer oe_right"
                                            attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                                                                       ('payment_state' ,'=', 'invoicing_legacy')]}">

                                            <field name="tax_totals_json" widget="account-tax-totals-field" nolabel="1" colspan="2"/>

                                            <field name="invoice_payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                            <field name="amount_residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                        </group>
                                        <field name="invoice_outstanding_credits_debits_widget"
                                            class="oe_invoice_outstanding_credits_debits"
                                            colspan="2" nolabel="1" widget="payment"
                                            attrs="{'invisible': [('state', '!=', 'posted')]}"/>
                                    </group>
                                </group>
                            </page>
                            <page id="aml_tab" string="Journal Items" groups="account.group_account_readonly">
                                <div class="alert alert-info text-center mb-0" role="alert" attrs="{'invisible': ['|', ('payment_state', '!=', 'invoicing_legacy'), ('move_type', '=', 'entry')]}">
                                    <span>This entry has been generated through the Invoicing app, before installing Accounting. Its balance has been imported separately.</span>
                                </div>
                                <field name="line_ids" mode="tree,kanban"
                                       context="{'default_move_type': context.get('default_move_type'), 'line_ids': line_ids, 'journal_id': journal_id, 'default_partner_id': commercial_partner_id, 'default_currency_id': currency_id or company_currency_id, 'kanban_view_ref': 'account.account_move_line_view_kanban_mobile'}"
                                       attrs="{'invisible': [('payment_state', '=', 'invoicing_legacy'), ('move_type', '!=', 'entry')]}">
                                    <tree create="false" delete="false" editable="bottom" string="Journal Items"
                                          decoration-muted="display_type in ('line_section', 'line_note')"
                                          default_order="sequence, date desc, move_name desc, id">
                                        <!-- Displayed fields -->
                                        <field name="challan_no"/>
                                        <field name="account_id"
                                               attrs="{
                                                    'required': [('display_type', 'not in', ('line_section', 'line_note'))],
                                                    'invisible': [('display_type', 'in', ('line_section', 'line_note'))],
                                               }"
                                               domain="[('deprecated', '=', False), ('company_id', '=', parent.company_id)]" />
                                        <field name="partner_id"
                                               domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]"
                                               attrs="{'column_invisible': [('parent.move_type', '!=', 'entry')]}"/>
                                        <field name="name" widget="section_and_note_text" optional="show"/>
                                        <field name="analytic_account_id"
                                               optional="hide"
                                               domain="['|', ('company_id', '=', parent.company_id), ('company_id', '=', False)]"
                                               groups="analytic.group_analytic_accounting"
                                               attrs="{'invisible': [('display_type', 'in', ('line_section', 'line_note'))]}"/>
                                        <field name="analytic_tag_ids"
                                               optional="show"
                                               groups="analytic.group_analytic_tags"
                                               widget="many2many_tags"
                                               attrs="{'invisible': [('display_type', 'in', ('line_section', 'line_note'))]}"/>
                                        <field name="date_maturity"
                                               optional="show"
                                               invisible="context.get('view_no_maturity')"
                                               attrs="{'invisible': [('display_type', 'in', ('line_section', 'line_note'))]}"/>
                                        <field name="amount_currency"
                                               groups="base.group_multi_currency"
                                               optional="hide"/>
                                        <field name="currency_id" options="{'no_create': True}"
                                               groups="base.group_multi_currency"
                                               attrs="{'column_invisible': [('parent.move_type', '!=', 'entry')]}"/>
                                        <field name="tax_ids" widget="many2many_tags"
                                               optional="hide"
                                               domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain)]"
                                               context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain}"
                                               options="{'no_create': True}"
                                               force_save="1"
                                               attrs="{'readonly': [
                                                    '|', '|',
                                                    ('display_type', 'in', ('line_section', 'line_note')),
                                                    ('tax_line_id', '!=', False),
                                                    '&amp;',
                                                    ('parent.move_type', 'in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),
                                                    ('account_internal_type', 'in', ('receivable', 'payable')),
                                                ]}"/>
                                        <field name="debit"
                                               sum="Total Debit"
                                               attrs="{'invisible': [('display_type', 'in', ('line_section', 'line_note'))]}"/>
                                        <field name="credit"
                                               sum="Total Credit"
                                               attrs="{'invisible': [('display_type', 'in', ('line_section', 'line_note'))]}"/>

                                        <field name="tax_tag_ids"
                                               widget="many2many_tags"
                                               string="Tax Grids"
                                               optional="show"
                                               options="{'no_create': True}"
                                               domain="[
                                                    ('applicability', '=', 'taxes'),
                                                    '|', ('country_id', '=', parent.tax_country_id),
                                                    ('country_id', '=', False),
                                                ]"/>

                                        <field name="tax_tag_invert" readonly="1" optional="hide" groups="base.group_no_one"/>

                                        <!-- Buttons -->
                                        <field name="label_id" optional="hide" readonly="1" force_save='1'/>
                                        <field name="challan_id" optional="hide" readonly="1"/>
                                        <field name="reconciled" optional="hide" readonly="1"/>
                                        <field name="full_reconcile_id" optional="hide" readonly="1"/>
<!--                                        <button name="action_challan_entry" type="object" icon="fa-calendar" string="Challan"-->
<!--                                                aria-label="Generate Challan" class="float-right"-->
<!--                                                attrs="{'invisible': ['|','|', '|',('account_internal_type', 'not in', ('receivable', 'payable')),-->
<!--                                                    ('challan_id','!=',False),('reconciled','=',True),('parent.move_type','!=','out_invoice')],-->
<!--                                                }"/>-->
                                        <!--
                                        attrs="{'invisible': ['|',('account_internal_group', 'not in', ('receivable', 'payable')),('challan_id','!=',False)],
                                                    'column_invisible': [('parent.state', '!=', 'posted')]}"
                                                    -->
<!--                                        <button name="action_automatic_entry" type="object" icon="fa-calendar" string="Cut-Off"-->
<!--                                                aria-label="Change Period" class="float-right"-->
<!--                                                attrs="{'invisible': [('account_internal_group', 'not in', ('income', 'expense'))], 'column_invisible': ['|', ('parent.move_type', '=', 'entry'), ('parent.state', '!=', 'posted')]}"-->
<!--                                                context="{'hide_automatic_options': 1, 'default_action': 'change_period'}"/>-->

                                        <!-- Others fields -->
                                        <field name="challan_id" invisible="1"/>
                                        <field name="payment_id" invisible="1"/>
                                        <field name="product_id" invisible="1"/>
                                        <field name="quantity" invisible="1"/>
                                        <field name="product_uom_category_id" invisible="1"/>
                                        <field name="product_uom_id" invisible="1"/>
                                        <field name="price_unit" invisible="1"/>
                                        <field name="discount" invisible="1"/>
                                        <field name="price_subtotal" invisible="1"/>
                                        <field name="price_total" invisible="1"/>
                                        <field name="reconciled" invisible="1"/>

                                        <field name="sequence" invisible="1"/>
                                        <field name="move_name" invisible="1"/>
                                        <field name="date" invisible="1"/>
                                        <field name="group_tax_id" invisible="1"/>
                                        <field name="tax_line_id" invisible="1"/>
                                        <field name="tax_group_id" invisible="1"/>
                                        <field name="tax_repartition_line_id" invisible="1" force_save="1"/>
                                        <field name="tax_base_amount" invisible="1" force_save="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="recompute_tax_line" invisible="1" force_save="1"/>
                                        <field name="display_type" force_save="1" invisible="1"/>
                                        <field name="is_rounding_line" invisible="1"/>
                                        <field name="exclude_from_invoice_tab" invisible="1"/>
                                        <field name="account_internal_type" invisible="1"/>
                                        <field name="account_internal_group" invisible="1"/>
                                    </tree>
                                    <!-- Form view to cover mobile use -->
                                    <form>
                                      <group>
                                            <group>
                                            <field name="group_tax_id" invisible="1"/>
                                            <field name="tax_line_id" invisible="1"/>
                                            <field name="account_id" domain="[('company_id', '=', parent.company_id), ('deprecated', '=', False)]"/>
                                            <field name="partner_id" domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]"/>
                                            <field name="name"/>
                                            <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>
                                            <field name="analytic_tag_ids" groups="analytic.group_analytic_tags" widget="many2many_tags"/>
                                            <field name="amount_currency" groups="base.group_multi_currency"/>
                                            <field name="company_currency_id" invisible="1"/>
                                            <field name="company_id" invisible="1"/>
                                            <field name="currency_id" options="{'no_create': True}" groups="base.group_multi_currency"/>
                                            <field name="debit" sum="Total Debit"/>
                                            <field name="credit" sum="Total Credit"/>
                                            <field name="tax_ids" string="Taxes Applied" widget="many2many_tags" options="{'no_create': True}"/>
                                            <field name="date_maturity" required="0" invisible="context.get('view_no_maturity', False)"/>
                                            <field name="recompute_tax_line" invisible="1" readonly="1"/>
                                          </group>
                                          <group>
                                                <field name="challan_id" readonly="1"/>
                                                <field name="challan_no" readonly="1"/>
                                                <field name="label_id" readonly="1"/>
                                          </group>
                                        </group>
                                    </form>
                                </field>
                            </page>
                            <page id="other_tab" string="Other Info" name="other_info"
                                  attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}">
                                <group id="other_tab_group">
                                    <group string="Invoice" name="sale_info_group"
                                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">

                                        <field name="user_id" invisible="1" force_save="1"/>
                                        <field name="invoice_user_id" domain="[('share', '=', False)]" widget="many2one_avatar_user"/>
                                        <field name="invoice_origin" string="Source Document" force_save="1" invisible="1"/>
                                        <field name="journal_id" groups="account.group_account_user"
                                               options="{'no_create': True}"/>
                                    </group>
                                    <group string="Accounting" name="accounting_info_group"
                                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}">
                                        <field name="company_id" groups="base.group_multi_company"/>

                                        <field name="to_check"/>
                                        <field name="waiver_ids" widget="many2many_tags" readonly="1"
                                            attrs="{'invisible': [('move_type', '!=', 'out_invoice')]}"/>
                                        <field name="waiver_percentage" readonly="1"
                                            attrs="{'invisible': [('move_type', '!=', 'out_invoice')]}"/>
                                        <field name="waiver_amount" readonly="1"
                                            attrs="{'invisible': [('move_type', '!=', 'out_invoice')]}"/>
                                    </group>
                                    <group name="student_ledger_group">
                                        <field name="student_ledger_id" readonly="1"/>
                                        <field name="payment_ledger_id" readonly="1"/>
                                    </group>
                                    <group attrs="{'invisible': [('move_type', '!=', 'out_invoice')]}">
                                        <field name="semester_gross_fee" readonly="1"/>
                                        <field name="add_drop_no" readonly="1" attrs="{'invisible':[('challan_type','!=','add_drop')]}"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_fee_receipts_filter" model="ir.ui.view">
            <field name="name">account.move.select</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <search string="Search Receipts">
                    <field name="name" string="Receipts"
                           filter_domain="['|','|', ('name','ilike',self), ('reference', 'ilike', self), ('partner_id', 'child_of', self)]"/>
                    <field name="student_id"/>

                    <separator/>
                    <filter name="draft" string="Draft" domain="[('payment_state','=','not_paid')]"/>
                    <filter name="paid" string="Paid" domain="[('payment_state', 'in', ('in_payment','paid'))]"/>
                    <filter name="late" string="Overdue"
                            domain="['&amp;', ('invoice_date_due', '&lt;', time.strftime('%%Y-%%m-%%d')), ('payment_state', '=', 'not_paid')]"
                            help="Overdue invoices, maturity date passed"/>

                    <separator/>
                    <filter name="unposted" string="Unposted" domain="[('state', '=', 'draft')]"/>
                    <filter name="posted" string="Posted" domain="[('state', '=', 'posted')]"/>

                    <separator/>
                    <field name="date" string="Period"/>

                    <separator/>
                    <filter name="to_be_filter" string="To Be" domain="[('to_be', '=', True)]"/>

                    <group expand="0" string="Group By">
                        <filter name="group_by_fee_structure" string="Fee Structure"
                                context="{'group_by':'fee_structure_id'}"/>
                        <filter name="group_by_academic_term" string="Academic Term" context="{'group_by':'term_id'}"/>

                        <separator/>
                        <filter name="group_by_institute" string="Institute" context="{'group_by':'institute_id'}"/>
                        <filter name="group_by_session" string="Session" context="{'group_by':'session_id'}"/>

                        <separator/>
                        <filter name="group_by_student" string="Student" context="{'group_by':'student_id'}"/>
                        <filter name="group_by_invoice_payment_status" string="Payment Status" context="{'group_by':'payment_state'}"/>
                        <filter name="group_by_move_status" string="Status" context="{'group_by':'state'}"/>
                        <separator/>
                        <filter name="group_by_invoice_date" string="Receipt Date" context="{'group_by':'invoice_date'}"/>
                        <filter name="group_by_due_date" string="Due Date" context="{'group_by':'invoice_date_due'}"/>
                        <filter name="group_by_payment_date" string="Payment Date" context="{'group_by':'payment_date'}"/>
                        <separator/>

                        <filter name="group_by_donor" string="Donors" context="{'group_by':'donor_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="odoocms_receipt_pivot" model="ir.ui.view">
            <field name="name">account.move.pivot</field>
            <field name="model">account.move</field>
            <field name="priority">64</field>
            <field name="arch" type="xml">
                <pivot string="Receipts" display_quantity="true">
                    <field name="institute_id" type="row"/>
                    <field name="session_id" type="col"/>
                    <field name="term_id"/>
                    <field name="amount_total_signed" string='Amount' type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="action_odoocms_receipt" model="ir.actions.act_window">
            <field name="name">Fee Receipts</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form,pivot</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('move_type','=','out_invoice'), ('is_fee', '=', True),('is_scholarship_fee','!=', True)]</field>
            <field name="context">{'move_type':'out_invoice', 'journal_type': 'sale', 'search_default_current':1,} </field>
            <field name="search_view_id" ref="view_fee_receipts_filter"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to create a fee receipts.
                </p>
            </field>
        </record>

        <record id="action_odoocms_receipt_view1" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="odoocms_receipt_tree"/>
            <field name="act_window_id" ref="action_odoocms_receipt"/>
        </record>

        <record id="action_odoocms_receipt_view2" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="odoocms_receipt_form"/>
            <field name="act_window_id" ref="action_odoocms_receipt"/>
        </record>

        <record id="action_odoocms_receipt_view3" model="ir.actions.act_window.view">
            <field name="sequence" eval="3"/>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="odoocms_receipt_pivot"/>
            <field name="act_window_id" ref="action_odoocms_receipt"/>
        </record>

        <menuitem
                id="menu_student_fee_receipt"
                parent="menu_odoocms_fee_receipts_main"
                name="Fee Receipts"
                action="action_odoocms_receipt"
                groups="odoocms_fee.group_fee_coordinator,odoocms_fee.group_fee_manager,odoocms_fee.group_fee_readonly_user"
                sequence="60"/>



        <!--***** Receipt - Credit Note *****-->
        <record id="odoocms_receipt_credit_tree" model="ir.ui.view">
            <field name="name">account.move.tree</field>
            <field name="model">account.move</field>
            <field name="priority">64</field>
            <field name="arch" type="xml">
                <tree string="Fee - Credit Note" delete="false"
                      decoration-primary="payment_state == 'not_paid'"
                      decoration-success="payment_state in ('in_payment','paid')">

                    <field name="student_id"/>
<!--                    <field name="student_tags" optional="show"/>-->
<!--                    <field name="institute_code" optional="show" string="Institute"/>-->
                    <field name="term_id"/>
                    <field name="invoice_date" string="Invoice Date" optional="show"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="amount_total_signed" string="Total" sum="Total"/>
                    <field name="amount_residual" optional="1" string="Amount Due" sum="Amount Due"/>

                    <field name="payment_state" string="Invoice Status"/>
                    <field name="state" optional="hide"/>

                    <field name="is_fee" invisible="1"/>
                    <field name="commercial_partner_id" invisible="1"/>
                    <field name="reference" invisible="1"/>
                    <field name="name" invisible="1"/>
                    <field name="company_id" invisible="1"/>
                    <field name="user_id" string="Responsible" invisible="1"/>
                    <field name="invoice_origin" invisible="1"/>
                    <field name="currency_id" invisible="0"/>
                    <field name="company_currency_id" invisible="1"/>
                    <!--                    <field name="type" invisible="1"/>-->
                    <field name="cancel_due_to_arrears" invisible="1"/>

                    <!-- Optional Fields student related, Purpose of use is to provide the search facility for these fields -->
<!--                    <field name="batch_id" optional="1"/>-->
<!--                    <field name="career_id" optional="1"/>-->
<!--                    <field name="institute_id" optional="1"/>-->
<!--                    <field name="discipline_id" optional="1"/>-->
<!--                    <field name="campus_id" optional="1"/>-->
<!--                    <field name="session_id" optional="1"/>-->

                </tree>
            </field>
        </record>

        <record id="action_odoocms_receipt_refund" model="ir.actions.act_window">
            <field name="name">Receipt - Credit Note</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form,pivot</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('move_type','=','out_refund'), ('is_fee', '=', True)]</field>
            <field name="context">{'default_move_type': 'out_refund', 'move_type': 'out_refund', 'journal_type': 'sale',
                'search_default_is_fee':1, 'default_is_fee':1}
            </field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a credit note
                </p>
                <p>
                    Note that the easiest way to create a credit note is to do it directly
                    from the Student invoice.
                </p>
            </field>
        </record>

        <record id="action_odoocms_receipt_refund_view1" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="odoocms_receipt_credit_tree"/>
            <field name="act_window_id" ref="action_odoocms_receipt_refund"/>
        </record>

        <record id="action_odoocms_receipt_refund_view2" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="odoocms_receipt_form"/>
            <field name="act_window_id" ref="action_odoocms_receipt_refund"/>
        </record>

        <record id="action_odoocms_receipt_refund_view3" model="ir.actions.act_window.view">
            <field name="sequence" eval="3"/>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="odoocms_receipt_pivot"/>
            <field name="act_window_id" ref="action_odoocms_receipt_refund"/>
        </record>

        <menuitem
                id="menu_student_fee_receipt_refund"
                parent="menu_odoocms_fee_receipts_main"
                name="Receipt - Credit Note"
                action="action_odoocms_receipt_refund"
                groups="odoocms_fee.group_fee_coordinator,odoocms_fee.group_fee_manager,odoocms_fee.group_fee_readonly_user"
                sequence="70"/>


        <!--***** Scholarship Action *****-->
        <record id="action_odoocms_scholarship_receipt" model="ir.actions.act_window">
            <field name="name">Scholarship Receipts</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form,pivot</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('move_type','=','out_invoice'), ('is_scholarship_fee', '=', True)]</field>
            <field name="context">{'move_type':'out_invoice', 'journal_type': 'sale', 'search_default_current':1,}
            </field>
            <field name="search_view_id" ref="view_fee_receipts_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                </p>
            </field>
        </record>

        <record id="action_odoocms_scholarship_receipt_view1" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="odoocms_receipt_tree"/>
            <field name="act_window_id" ref="action_odoocms_scholarship_receipt"/>
        </record>

        <record id="action_odoocms_scholarship_receipt_view2" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="odoocms_receipt_form"/>
            <field name="act_window_id" ref="action_odoocms_scholarship_receipt"/>
        </record>

        <record id="action_odoocms_scholarship_receipt_view3" model="ir.actions.act_window.view">
            <field name="sequence" eval="3"/>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="odoocms_receipt_pivot"/>
            <field name="act_window_id" ref="action_odoocms_scholarship_receipt"/>
        </record>


        <!--***** Hostel Fee Action *****-->
        <record id="action_odoocms_hostel_fee_receipt" model="ir.actions.act_window">
            <field name="name">Hostel Fee Receipts</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,form,pivot</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('move_type','=','out_invoice'), ('is_hostel_fee', '=', True)]</field>
            <field name="context">{'move_type':'out_invoice', 'journal_type': 'sale', 'search_default_current':1,}
            </field>
            <field name="search_view_id" ref="view_fee_receipts_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                </p>
            </field>
        </record>

        <record id="action_odoocms_hostel_receipt_view1" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="odoocms_receipt_tree"/>
            <field name="act_window_id" ref="action_odoocms_hostel_fee_receipt"/>
        </record>

        <record id="action_odoocms_hostel_receipt_view2" model="ir.actions.act_window.view">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="odoocms_receipt_form"/>
            <field name="act_window_id" ref="action_odoocms_hostel_fee_receipt"/>
        </record>

        <record id="action_odoocms_hostel_receipt_view3" model="ir.actions.act_window.view">
            <field name="sequence" eval="3"/>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="odoocms_receipt_pivot"/>
            <field name="act_window_id" ref="action_odoocms_hostel_fee_receipt"/>
        </record>



        <menuitem
                id="menu_student_hostel_fee_receipt"
                parent="menu_odoocms_fee_receipts_main"
                name="Hostel Fee Receipts"
                action="action_odoocms_hostel_fee_receipt"
                groups="odoocms_fee.group_fee_coordinator,odoocms_fee.group_fee_manager"
                sequence="80"/>

        <menuitem
                id="menu_student_scholarship_fee_receipt"
                parent="menu_odoocms_fee_receipts_main"
                name="Scholarschip Fee Receipts"
                action="action_odoocms_scholarship_receipt"
                groups="odoocms_fee.group_fee_coordinator,odoocms_fee.group_fee_manager,odoocms_fee.group_fee_readonly_user"
                sequence="90"/>



    </data>
</odoo>
